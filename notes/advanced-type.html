<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>高级类型 | TypeScript</title>
    <meta name="description" content="TypeScript 个人学习笔记">
    
    
    <link rel="preload" href="/notes/assets/css/0.styles.92a73b5e.css" as="style"><link rel="preload" href="/notes/assets/js/app.7bd01eb6.js" as="script"><link rel="preload" href="/notes/assets/js/6.fba5fac9.js" as="script"><link rel="prefetch" href="/notes/assets/js/10.6872a4a6.js"><link rel="prefetch" href="/notes/assets/js/11.408acd5f.js"><link rel="prefetch" href="/notes/assets/js/12.3182c647.js"><link rel="prefetch" href="/notes/assets/js/13.c94a018f.js"><link rel="prefetch" href="/notes/assets/js/14.8280cb26.js"><link rel="prefetch" href="/notes/assets/js/15.966d1ce9.js"><link rel="prefetch" href="/notes/assets/js/16.3ca8eb8e.js"><link rel="prefetch" href="/notes/assets/js/17.65d4bf4a.js"><link rel="prefetch" href="/notes/assets/js/18.2c927a57.js"><link rel="prefetch" href="/notes/assets/js/19.97694aeb.js"><link rel="prefetch" href="/notes/assets/js/2.bca23384.js"><link rel="prefetch" href="/notes/assets/js/3.8c593d68.js"><link rel="prefetch" href="/notes/assets/js/4.34efd5e8.js"><link rel="prefetch" href="/notes/assets/js/5.193875b0.js"><link rel="prefetch" href="/notes/assets/js/7.a6c23ead.js"><link rel="prefetch" href="/notes/assets/js/8.a3b8265e.js"><link rel="prefetch" href="/notes/assets/js/9.f8f3bcfa.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.92a73b5e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><!----> <span class="site-name">TypeScript</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notes/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/rickychoi1994/notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notes/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/rickychoi1994/notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-group-items"><li><a href="/notes/notes/" class="sidebar-link">基础类型</a></li><li><a href="/notes/notes/symbol.html" class="sidebar-link">Symbol</a></li><li><a href="/notes/notes/interface.html" class="sidebar-link">接口</a></li><li><a href="/notes/notes/function.html" class="sidebar-link">函数</a></li><li><a href="/notes/notes/generics.html" class="sidebar-link">泛型</a></li><li><a href="/notes/notes/es6-class-1.html" class="sidebar-link">ES6中的类 - 基础</a></li><li><a href="/notes/notes/es6-class-2.html" class="sidebar-link">ES6中的类 - 进阶</a></li><li><a href="/notes/notes/class.html" class="sidebar-link">ts中的类</a></li><li><a href="/notes/notes/enum.html" class="sidebar-link">枚举</a></li><li><a href="/notes/notes/inference-compatibility.html" class="sidebar-link">类型兼容性</a></li><li><a href="/notes/notes/advanced-type.html" class="active sidebar-link">高级类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#交叉类型" class="sidebar-link">交叉类型</a></li><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#联合类型" class="sidebar-link">联合类型</a></li><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#类型保护" class="sidebar-link">类型保护</a></li><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#null-undefined" class="sidebar-link">null undefined</a></li><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#类型保护和类型断言" class="sidebar-link">类型保护和类型断言</a></li><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#类型别名" class="sidebar-link">类型别名</a></li><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#接口-vs-类型别名" class="sidebar-link">接口 vs 类型别名</a></li><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#字符串字面量类型" class="sidebar-link">字符串字面量类型</a></li><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#数字字面量类型" class="sidebar-link">数字字面量类型</a></li><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#枚举成员类型" class="sidebar-link">枚举成员类型</a></li><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#可辨识联合" class="sidebar-link">可辨识联合</a></li><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#完整性检查" class="sidebar-link">完整性检查</a></li><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#多态的this类型" class="sidebar-link">多态的this类型</a></li><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#索引类型" class="sidebar-link">索引类型</a></li><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#映射类型" class="sidebar-link">映射类型</a></li><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#条件类型" class="sidebar-link">条件类型</a></li><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#更新" class="sidebar-link">更新</a></li><li class="sidebar-sub-header"><a href="/notes/notes/advanced-type.html#unknown类型" class="sidebar-link">unknown类型</a></li></ul></li><li><a href="/notes/notes/es6-module.html" class="sidebar-link">ES6和NodeJs中的模块</a></li><li><a href="/notes/notes/ts-module.html" class="sidebar-link">TS中的模块</a></li><li><a href="/notes/notes/merging.html" class="sidebar-link">声明合并</a></li><li><a href="/notes/notes/decorator.html" class="sidebar-link">装饰器</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="高级类型"><a href="#高级类型" aria-hidden="true" class="header-anchor">#</a> 高级类型</h1> <p><a href="https://www.tslang.cn/docs/handbook/advanced-types.html" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="交叉类型"><a href="#交叉类型" aria-hidden="true" class="header-anchor">#</a> 交叉类型</h2> <p>使用 <code>&amp;</code> ，将多个类型合并为一个类型</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>arg1<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> arg2<span class="token punctuation">:</span> <span class="token constant">U</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token operator">&amp;</span> <span class="token parameter"><span class="token constant">U</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token constant">T</span> <span class="token operator">&amp;</span> <span class="token constant">U</span>
  res <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span>
  <span class="token keyword">return</span> res
<span class="token punctuation">}</span>
</code></pre></div><h2 id="联合类型"><a href="#联合类型" aria-hidden="true" class="header-anchor">#</a> 联合类型</h2> <p>使用 <code>|</code> ，表示一个值可以是几种类型之一</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> getLength <span class="token operator">=</span> <span class="token punctuation">(</span>content<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>content <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>content <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> content<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="类型保护"><a href="#类型保护" aria-hidden="true" class="header-anchor">#</a> 类型保护</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> valueList <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token string">'abc'</span> <span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">getRandomValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> num <span class="token operator">=</span> Math<span class="token punctuation">.</span>random <span class="token operator">*</span> <span class="token number">10</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> valueList<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> valueList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> item <span class="token operator">=</span> <span class="token function">getRandomValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// if (item.length) {    // 类型 'string | number' 上不存在属性“length”</span>
<span class="token comment">//   console.log(item.length)</span>
<span class="token comment">// } else {</span>
<span class="token comment">//   console.log(item.toFixed())</span>
<span class="token comment">// }</span>
<span class="token comment">// 若想使这段代码正常运行，需要使用类型断言</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>item <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item <span class="token keyword">as</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="用户自定义类型保护"><a href="#用户自定义类型保护" aria-hidden="true" class="header-anchor">#</a> 用户自定义类型保护</h3> <p>为了不多次使用类型断言，并且为了检查过类型就能在之后的每个分支里清楚知道类型，要定义一个类型保护，简单地定义一个函数，它的返回值是一个 类型谓词</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">isString</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> value <span class="token keyword">is</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'string'</span>
<span class="token punctuation">}</span>

</code></pre></div><p>在上面的函数里 <code>value is string</code> 就是类型谓词，谓词为 <code>parameterName is Type</code> 这种形式，<code>parameterName</code> 必须是来自于当前函数签名里的一个参数名。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isString</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token comment">// item: string</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// item: number</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="typeof类型保护"><a href="#typeof类型保护" aria-hidden="true" class="header-anchor">#</a> typeof类型保护</h3> <p>ts 可以将 <code>typeof value === 'string'</code> 识别成一个类型保护，也就是说直接在代码里检查类型了。不用再去抽象成一个函数。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> item <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>typeof类型保护只有两种形式能被识别：</p> <ul><li><code>typeof v === 'typename'</code> 和 <code>typeof v !== 'typename'</code></li> <li><code>typename</code> 必须是 <code>number</code>、<code>string</code>、<code>boolean</code> 或 <code>symbol</code></li></ul> <h3 id="instanceof类型保护"><a href="#instanceof类型保护" aria-hidden="true" class="header-anchor">#</a> instanceof类型保护</h3> <p><code>instanceof</code> 类型保护是通过构造函数来细化类型的一种方式。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">CreatedByClass1</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> age<span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">18</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">CreatedByClass2</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> name<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'jane'</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.5</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">CreatedByClass1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">CreatedByClass2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> item <span class="token operator">=</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token keyword">instanceof</span> <span class="token class-name">CreatedByClass1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>age<span class="token punctuation">)</span>  <span class="token comment">// item: CreatedByClass1</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// item: CreatedByClass2</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="null-undefined"><a href="#null-undefined" aria-hidden="true" class="header-anchor">#</a> null undefined</h2> <p>ts 具有两种特殊的类型，<code>null</code> 和 <code>undefined</code>，它们分别是具有值 <code>null</code> 和 <code>undefined</code>。默认情况下，类型检查器认为null和undefined可以赋值给任何类型。<code>null</code> 与 <code>undefined</code> 是所有其它类型的一个有效值。这也意味着，你阻止不了将它们赋值给其它类型，就算是你想要阻止这种情况也不行。</p> <p><code>--strictNullChecks</code> 标记可以解决此错误：当声明一个变量时，它不会自动地包含 <code>null</code> 或 <code>undefined</code>。可以使用联合类型明确的包含它们。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">'foo'</span>
s <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// error 'null' 不能赋值给 'string'</span>

<span class="token keyword">let</span> sn<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token string">'bar'</span>
sn <span class="token operator">=</span> <span class="token keyword">null</span>

sn <span class="token operator">=</span> undefined <span class="token comment">// error undefined 不能赋值给 'string | null'</span>
</code></pre></div><p>使用 <code>--strictNullChecks</code> 后，可选参数和可选属性都会被自动加上 <code>| undefined</code></p> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>注意，按照JavaScript的语义，TypeScript会把 <code>null</code> 和 <code>undefined</code> 区别对待。<code>string | null</code>， <code>string | undefined</code> 和 <code>string | undefined | null</code> 是不同的类型。</p></div> <h2 id="类型保护和类型断言"><a href="#类型保护和类型断言" aria-hidden="true" class="header-anchor">#</a> 类型保护和类型断言</h2> <p>由于可以为null的类型是通过联合类型实现，那么需要使用类型保护来去除 null。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">getLengh</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
  <span class="token comment">// if (value === null) {</span>
  <span class="token comment">//   return 0</span>
  <span class="token comment">// } else {</span>
  <span class="token comment">//   return value.length</span>
  <span class="token comment">// }</span>

  <span class="token comment">// 简化后</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>value <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
<span class="token punctuation">}</span>
</code></pre></div><p>如果编译器不能够去除 null或 undefined，你可以使用类型断言手动去除。 语法是添加 <code>!</code> 后缀：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">getSplicedStr</span><span class="token punctuation">(</span><span class="token parameter">num<span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">getRes</span><span class="token punctuation">(</span><span class="token parameter">prefix<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> prefix <span class="token operator">+</span> num<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  num <span class="token operator">=</span> num <span class="token operator">||</span> <span class="token number">0.1</span>
  <span class="token keyword">return</span> <span class="token function">getRes</span><span class="token punctuation">(</span><span class="token string">'jane-'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">getSpliceStr</span><span class="token punctuation">(</span><span class="token number">3.14</span><span class="token punctuation">)</span> <span class="token comment">// jane-3</span>
</code></pre></div><h2 id="类型别名"><a href="#类型别名" aria-hidden="true" class="header-anchor">#</a> 类型别名</h2> <p>类型别名会给一个类型起一个新名字。类型别名有时和接口很像，但是可以作用于原始值，联合类型，元组以及其它任何你需要手写的类型。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> Name <span class="token operator">=</span> <span class="token builtin">string</span>
<span class="token keyword">let</span> name<span class="token punctuation">:</span> Name <span class="token operator">=</span> <span class="token string">'jane'</span> <span class="token comment">// name: string</span>
</code></pre></div><p>类型别名也可以是泛型：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> Container<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token punctuation">}</span>

<span class="token keyword">let</span> content<span class="token punctuation">:</span> Container<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  value<span class="token punctuation">:</span> <span class="token string">'abc'</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> content2<span class="token punctuation">:</span> Container<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  value<span class="token punctuation">:</span> <span class="token number">123</span>
<span class="token punctuation">}</span>
</code></pre></div><p>类型别名页可以在属性里引用自己：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> Tree<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  value<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
  child<span class="token operator">?</span><span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> tree<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  value<span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span>
  child<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span>
    child<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> <span class="token string">'c'</span>
      <span class="token comment">// child  可以一直循环下去</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然而，类型别名不能出现在声明右侧的任何地方。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> Yikes <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Yikes<span class="token operator">&gt;</span> <span class="token comment">// error</span>
</code></pre></div><h2 id="接口-vs-类型别名"><a href="#接口-vs-类型别名" aria-hidden="true" class="header-anchor">#</a> 接口 vs 类型别名</h2> <p>类型别名可以像接口一样；然而，仍有一些细微差别。</p> <ul><li>接口创建了一个新的名字，可以在其它任何地方使用。类型别名并不创建新名字，比如：错误信息就不会使用别名。</li> <li>另一个重要区别是类型别名不能被 extends和 implements（自己也不能 extends和 implements其它类型）
因为 软件中的对象应该对于扩展是开放的，但是对于修改是封闭的，应该尽量去使用接口代替类型别名。</li> <li>另一方面，如果你无法通过接口来描述一个类型并且需要使用联合类型或元组类型，这时通常会使用类型别名。</li></ul> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> Alias <span class="token operator">=</span> <span class="token punctuation">{</span>
  num<span class="token punctuation">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Interface</span> <span class="token punctuation">{</span>
  num<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> _alias<span class="token punctuation">:</span> Alias <span class="token operator">=</span> <span class="token punctuation">{</span>
  num<span class="token punctuation">:</span> <span class="token number">123</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> _interface<span class="token punctuation">:</span> Interface <span class="token operator">=</span> <span class="token punctuation">{</span>
  num<span class="token punctuation">:</span> <span class="token number">321</span>
<span class="token punctuation">}</span>

_alias <span class="token operator">=</span> _interface <span class="token comment">// 没问题</span>
</code></pre></div><h2 id="字符串字面量类型"><a href="#字符串字面量类型" aria-hidden="true" class="header-anchor">#</a> 字符串字面量类型</h2> <p>字符串字面量类型允许你指定字符串必须的固定值。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> Name <span class="token operator">=</span> <span class="token string">'Jane'</span>
<span class="token keyword">let</span> name1<span class="token punctuation">:</span> Name <span class="token operator">=</span> <span class="token string">'Jane'</span>
<span class="token keyword">let</span> name2<span class="token punctuation">:</span> Name <span class="token operator">=</span> <span class="token string">'tom'</span> <span class="token comment">// error 不能将类型 'tom' 分配给类型 'Jane'</span>
</code></pre></div><h2 id="数字字面量类型"><a href="#数字字面量类型" aria-hidden="true" class="header-anchor">#</a> 数字字面量类型</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> Age <span class="token operator">=</span> <span class="token number">18</span>

<span class="token keyword">interface</span> <span class="token class-name">Info</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> Age<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> info<span class="token punctuation">:</span> Info <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'jane'</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> <span class="token number">18</span>
  <span class="token comment">// age: 20 // error 不能将类型 '20' 分配给类型 '18'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="枚举成员类型"><a href="#枚举成员类型" aria-hidden="true" class="header-anchor">#</a> 枚举成员类型</h2> <p>在枚举一节里提到，当每个枚举成员都是用字面量初始化的时候枚举成员是具有类型的。</p> <p>在谈及&quot;单例类型&quot;的时候，多数是指枚举成员类型和数字/字符串字面量类型。</p> <p><a href="https://rickychoi1994.github.io/notes/notes/enum.html#%E6%9E%9A%E4%B8%BE%E6%88%90%E5%91%98%E7%B1%BB%E5%9E%8B-%E8%81%94%E5%90%88%E6%9E%9A%E4%B8%BE" target="_blank" rel="noopener noreferrer">枚举类型<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="可辨识联合"><a href="#可辨识联合" aria-hidden="true" class="header-anchor">#</a> 可辨识联合</h2> <p>可以合并单例类型，联合类型，类型保护和类型别名来创建一个叫做 可辨识联合的高级模式，它也称做 标签联合 或 代数数据类型。可辨识联合在函数式编程很有用处。 一些语言会自动辨识联合；而TypeScript则基于已有的JavaScript模式。 它具有3个要素：</p> <ol><li>具有普通的单例类型属性 — 可辨识的特征。</li> <li>一个类型别名包含了那些类型的联合 — 联合。</li> <li>此属性上的类型保护。</li></ol> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">Square</span> <span class="token punctuation">{</span>
    kind<span class="token punctuation">:</span> <span class="token string">&quot;square&quot;</span><span class="token punctuation">,</span>
    size<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>
    kind<span class="token punctuation">:</span> <span class="token string">&quot;rectangle&quot;</span><span class="token punctuation">,</span>
    width<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    height<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Circle</span> <span class="token punctuation">{</span>
    kind<span class="token punctuation">:</span> <span class="token string">&quot;circle&quot;</span><span class="token punctuation">,</span>
    radius<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面声明了将要联合的接口。每个接口都有 <code>kind</code> 属性但有不同的字符串字面量类型。kind属性称做 可辨识的特征 或 标签。其它的属性则特定于各个接口。 注意，目前各个接口间是没有联系的。 下面我们把它们联合到一起：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> Shape <span class="token operator">=</span> Square <span class="token operator">|</span> Rectangle <span class="token operator">|</span> Circle
</code></pre></div><p>现在使用可辨识联合:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token parameter">s<span class="token punctuation">:</span> Shape</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span>kind<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'square'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> s<span class="token punctuation">.</span>size <span class="token operator">*</span> s<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">'rectangle'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> s<span class="token punctuation">.</span>height <span class="token operator">*</span> s<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">'circle'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> s<span class="token punctuation">.</span>radius <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="完整性检查"><a href="#完整性检查" aria-hidden="true" class="header-anchor">#</a> 完整性检查</h2> <p>当没有涵盖所有可辨识联合的变化时，想让编译器可以提示。 比如，如果添加了 Triangle 到 Shape，同时还需要更新 area:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> Shape <span class="token operator">=</span> Square <span class="token operator">|</span> Rectangle <span class="token operator">|</span> Circle <span class="token operator">|</span> Triangle

<span class="token keyword">function</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token parameter">s<span class="token punctuation">:</span> Shape</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span>kind<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'square'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> s<span class="token punctuation">.</span>size <span class="token operator">*</span> s<span class="token punctuation">.</span>size
        <span class="token keyword">case</span> <span class="token string">'rectangle'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> s<span class="token punctuation">.</span>height <span class="token operator">*</span> s<span class="token punctuation">.</span>width
        <span class="token keyword">case</span> <span class="token string">'circle'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> s<span class="token punctuation">.</span>radius <span class="token operator">**</span> <span class="token number">2</span> <span class="token comment">// ** es7的幂运算符 ** 2 平方 ** 3 立方</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// should error here - we didn't handle case &quot;triangle&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>有两种方式可以实现。 首先是启用 <code>--strictNullChecks</code> 并且指定一个返回值类型：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token parameter">s<span class="token punctuation">:</span> Shape</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span> <span class="token comment">// error: returns number | undefined</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span>kind<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'square'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> s<span class="token punctuation">.</span>size <span class="token operator">*</span> s<span class="token punctuation">.</span>size
        <span class="token keyword">case</span> <span class="token string">'rectangle'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> s<span class="token punctuation">.</span>height <span class="token operator">*</span> s<span class="token punctuation">.</span>width
        <span class="token keyword">case</span> <span class="token string">'circle'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> s<span class="token punctuation">.</span>radius <span class="token operator">**</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>因为 switch没有包涵所有情况，所以TypeScript认为这个函数有时候会返回 <code>undefined</code>。 如果明确地指定了返回值类型为 <code>number</code>，那么会看到一个错误，因为实际上返回值的类型为 <code>number | undefined</code>。 然而，这种方法存在些微妙之处且 <code>--strictNullChecks</code> 对旧代码支持不好。</p> <p>第二种方法使用 <code>never类型</code>，编译器用它来进行完整性检查：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">assertNever</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">:</span> <span class="token builtin">never</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">never</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Unexpected object: &quot;</span> <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token parameter">s<span class="token punctuation">:</span> Shape</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span>kind<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&quot;square&quot;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> s<span class="token punctuation">.</span>size <span class="token operator">*</span> s<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">&quot;rectangle&quot;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> s<span class="token punctuation">.</span>height <span class="token operator">*</span> s<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">&quot;circle&quot;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> s<span class="token punctuation">.</span>radius <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token function">assertNever</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error here if there are missing cases</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里， assertNever 检查 s 是否为<code>never类型</code>—即为除去所有可能情况后剩下的类型。 如果忘记了某个case，那么 s将具有一个真实的类型并且会得到一个错误。 这种方式需要定义一个额外的函数，但是在忘记某个case的时候也更加明显。</p> <h2 id="多态的this类型"><a href="#多态的this类型" aria-hidden="true" class="header-anchor">#</a> 多态的this类型</h2> <p>多态的 <code>this类型</code> 表示的是某个包含类或接口的子类型。这被称作 <code>F-bounded</code> 多态性。它能很容易的表现连贯接口间的继承。在下面的例子中，每个操作之后都返回 <code>this类型</code>：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">public</span> count<span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">+=</span> value
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token function">substract</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">-=</span> value
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Counter</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// Counter {count: 2}</span>
counter<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substract</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">// Counter {count: 4}</span>

<span class="token comment">// 由于这个类使用了 this类型，你可以继承它，新的类可以直接使用之前的方法，不需要做任何的改变。</span>
<span class="token keyword">class</span> <span class="token class-name">PowCounter</span> <span class="token keyword">extends</span> <span class="token class-name">Counter</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">public</span> count<span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">**</span> value
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> powCounter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PowCounter</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>     <span class="token comment">// PowCounter {count: 3}</span>
powCounter<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substract</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// PowCounter {count: 18}</span>
</code></pre></div><h2 id="索引类型"><a href="#索引类型" aria-hidden="true" class="header-anchor">#</a> 索引类型</h2> <p>使用索引类型，编译器就能够检查使用了动态属性名的代码。例如，一个常见的JavaScript模式是从对象中选取属性的子集。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">pluck</span><span class="token punctuation">(</span><span class="token parameter">o<span class="token punctuation">,</span> names</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> names<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">n</span> <span class="token operator">=&gt;</span> o<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="索引类型查询操作符"><a href="#索引类型查询操作符" aria-hidden="true" class="header-anchor">#</a> 索引类型查询操作符</h3> <p><code>keyof T</code> ，对于任何类型 T， keyof T的结果为 T上已知的公共属性名的联合。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">Info</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> infoProp<span class="token punctuation">:</span> <span class="token keyword">keyof</span> Info <span class="token comment">// infoProp = 'name' | 'age'</span>
infoProp <span class="token operator">=</span> <span class="token string">'name'</span>
infoProp <span class="token operator">=</span> <span class="token string">'age'</span>
infoProp <span class="token operator">=</span> <span class="token string">'sex'</span> <span class="token comment">// error 不能将类型“&quot;sex&quot;”分配给类型“&quot;name&quot; | &quot;age&quot;”</span>
</code></pre></div><div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> infoObj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'jane'</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> getValue<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>obj<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> names<span class="token punctuation">:</span> <span class="token constant">K</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> names<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> obj<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> values <span class="token operator">=</span> <span class="token function">getValue</span><span class="token punctuation">(</span>infoObj<span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// [ 'jane', 18 ]</span>
</code></pre></div><p><code>keyof</code> 会返回类型不为 <code>never</code> 、<code>null</code> 、<code>undefined</code> 类型的属性名的联合</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">Type</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
  b<span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
  c<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  d<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  e<span class="token punctuation">:</span> undefined<span class="token punctuation">;</span>
  f<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  g<span class="token punctuation">:</span> object
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Test <span class="token operator">=</span> Type<span class="token punctuation">[</span><span class="token keyword">keyof</span> Type<span class="token punctuation">]</span>
<span class="token comment">// type Test = string | number | object</span>
</code></pre></div><h3 id="索引访问操作符"><a href="#索引访问操作符" aria-hidden="true" class="header-anchor">#</a> 索引访问操作符</h3> <p><code>T[K]</code></p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> NameTypes <span class="token operator">=</span> Info<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token comment">// type NameTypes = string</span>

<span class="token keyword">function</span> getProperty<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>o<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token constant">K</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> o<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="索引类型和字符串索引签名"><a href="#索引类型和字符串索引签名" aria-hidden="true" class="header-anchor">#</a> 索引类型和字符串索引签名</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">Obj</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>key<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> keys<span class="token punctuation">:</span> <span class="token keyword">keyof</span> Obj<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span> <span class="token comment">// keys: string | number</span>
<span class="token keyword">let</span> values<span class="token punctuation">:</span> Obj<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">]</span> <span class="token comment">// values: number</span>
</code></pre></div><h2 id="映射类型"><a href="#映射类型" aria-hidden="true" class="header-anchor">#</a> 映射类型</h2> <p>从旧类型中创建新类型的一种方式。新类型以相同的类型去转换旧类型里每个属性。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">Info</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  sex<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 若此时想把Info里的属性变为只读或可选需要给每个属性加readonly或?</span>
<span class="token keyword">interface</span> <span class="token class-name">Info</span> <span class="token punctuation">{</span>
  <span class="token keyword">readonly</span> name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">readonly</span> age<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword">readonly</span> sex<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Info</span> <span class="token punctuation">{</span>
  name<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  sex<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用映射类型后就不需要这么麻烦了</span>
<span class="token keyword">type</span> InfoPartial<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> InfoReadonly<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span>p<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// 可选属性</span>
<span class="token keyword">type</span> partialInfo <span class="token operator">=</span> InfoPartial<span class="token operator">&lt;</span>Info<span class="token operator">&gt;</span>
<span class="token comment">// 只读属性</span>
<span class="token keyword">type</span> readonlyInfo <span class="token operator">=</span> InfoReadonly<span class="token operator">&lt;</span>Info<span class="token operator">&gt;</span>
</code></pre></div><h3 id="增加和移除特定修饰符"><a href="#增加和移除特定修饰符" aria-hidden="true" class="header-anchor">#</a> 增加和移除特定修饰符</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> RemoveReadonly<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">-</span><span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>TypeScript 中内置的映射类型</p> <ul><li>Readonly</li> <li>Partial</li> <li>Pick</li> <li>Record</li></ul> <p>Readonly，Partial 和 Pick 是同态的，但 Record 不是。 因为 Record 并不需要输入类型来拷贝属性，所以它不属于同态(同态是两个代数结构（例如群、环、或者向量空间）之间的保持结构不变的映射)。</p></div> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// Pick</span>
<span class="token keyword">interface</span> <span class="token class-name">Info</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  address<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> info<span class="token punctuation">:</span> Info <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'jane'</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
  address<span class="token punctuation">:</span> <span class="token string">'abc'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> pick<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>obj<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> keys<span class="token punctuation">:</span> <span class="token constant">K</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Pick<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res<span class="token punctuation">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> res
<span class="token punctuation">}</span>

<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">pick</span><span class="token punctuation">(</span>info<span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'address'</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// [name: &quot;jane&quot;, address: &quot;abc&quot;]</span>
</code></pre></div><div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// Record</span>
<span class="token keyword">function</span> mapObject<span class="token operator">&lt;</span><span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>obj<span class="token punctuation">:</span> Record<span class="token operator">&lt;</span><span class="token constant">K</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">:</span> <span class="token constant">T</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">U</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Record<span class="token operator">&lt;</span><span class="token constant">K</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res<span class="token punctuation">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> res
<span class="token punctuation">}</span>

<span class="token keyword">let</span> names <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">'world'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">'bye'</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> lengths <span class="token operator">=</span> <span class="token function">mapObject</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token comment">// {0: 5, 1: 5, 2: 3}</span>
</code></pre></div><h4 id="由映射类型进行推断"><a href="#由映射类型进行推断" aria-hidden="true" class="header-anchor">#</a> 由映射类型进行推断</h4> <p>拆包的过程</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// 对类型的属性包装</span>
<span class="token keyword">type</span> Proxy<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
  <span class="token keyword">set</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> Proxify<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> Proxy<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> proxify<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>obj<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Proxify<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> Proxify<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>

<span class="token keyword">let</span> props <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'jane'</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> proxyProps <span class="token operator">=</span> <span class="token function">proxify</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
proxyProps<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// jane</span>
proxyProps<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">)</span>
proxyProps<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// tom</span>

<span class="token comment">// 拆包</span>
<span class="token keyword">function</span> unproxify<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> Proxify<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token constant">T</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>

<span class="token keyword">let</span> originalProps <span class="token operator">=</span> <span class="token function">unproxify</span><span class="token punctuation">(</span>proxyProps<span class="token punctuation">)</span>
<span class="token comment">// {name: &quot;jane&quot;, age: 18}</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>注意这个拆包推断只适用于同态的映射类型。 如果映射类型不是同态的，那么需要给拆包函数一个明确的类型参数。</p></div> <h2 id="条件类型"><a href="#条件类型" aria-hidden="true" class="header-anchor">#</a> 条件类型</h2> <p>条件类型会以一个条件表达式进行类型关系检测，从而在两种类型中选择其一：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">U</span> <span class="token operator">?</span> <span class="token constant">X</span> <span class="token punctuation">:</span> <span class="token constant">Y</span>
</code></pre></div><p>若T能够赋值给U，那么类型是X，否则为Y。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> Type<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> exteds <span class="token builtin">string</span> <span class="token operator">?</span> <span class="token builtin">string</span> <span class="token punctuation">:</span> <span class="token builtin">number</span>
<span class="token keyword">let</span> index<span class="token punctuation">:</span> Type<span class="token operator">&lt;</span><span class="token string">'a'</span><span class="token operator">&gt;</span> <span class="token comment">// index: string</span>
</code></pre></div><p>当检测的类型是一个联合类型时，条件类型被称为分布式条件类型。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> TypeName<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">any</span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token punctuation">:</span> <span class="token builtin">never</span>
<span class="token keyword">type</span> Type <span class="token operator">=</span> TypeName<span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token operator">&gt;</span>
<span class="token comment">// type Type = string | number</span>
</code></pre></div><h3 id="条件类型和映射类型结合使用"><a href="#条件类型和映射类型结合使用" aria-hidden="true" class="header-anchor">#</a> 条件类型和映射类型结合使用</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> Type<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">Function</span> <span class="token operator">?</span> <span class="token constant">P</span> <span class="token punctuation">:</span> <span class="token builtin">never</span>
<span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span>

<span class="token keyword">interface</span> <span class="token class-name">Part</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  subparts<span class="token punctuation">:</span> Part<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">updatePart</span><span class="token punctuation">(</span>newName<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Test <span class="token operator">=</span> Type<span class="token operator">&lt;</span>Part<span class="token operator">&gt;</span>
<span class="token comment">//  type Test = &quot;updatePart&quot;</span>
</code></pre></div><p>与联合类型和交叉类型相似，有条件类型不允许递归地引用自己。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> ElementType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">?</span> ElementType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">:</span> <span class="token constant">T</span>  <span class="token comment">// error</span>
</code></pre></div><h3 id="条件类型中的类型推断"><a href="#条件类型中的类型推断" aria-hidden="true" class="header-anchor">#</a> 条件类型中的类型推断</h3> <p>条件类型的extends子语句中，允许出现 <code>infer</code> 声明，它会引入一个待推断的类型变量。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// T[number] 索引访问类型，获取的是值的类型</span>
<span class="token keyword">type</span> Type<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token constant">T</span>
<span class="token keyword">type</span> Test1 <span class="token operator">=</span> Type<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token comment">// type Test1 = string</span>
<span class="token keyword">type</span> Test2 <span class="token operator">=</span> Type<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span>   <span class="token comment">// type Test2 = string</span>

<span class="token keyword">type</span> Type<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Array</span><span class="token operator">&lt;</span>infer <span class="token constant">U</span><span class="token operator">&gt;</span> <span class="token operator">?</span> <span class="token constant">U</span> <span class="token punctuation">:</span> <span class="token constant">T</span>
<span class="token keyword">type</span> Test1 <span class="token operator">=</span> Type<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token comment">// type Test1 = string</span>
<span class="token keyword">type</span> Test2 <span class="token operator">=</span> Type<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span>   <span class="token comment">// type Test2 = string</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Typescript 内置的条件类型</p> <ul><li><code>Exclude&lt;T, U&gt;</code> -- 从T中剔除可以赋值给U的类型。</li> <li><code>Extract&lt;T, U&gt;</code> -- 提取T中可以赋值给U的类型。</li> <li><code>NonNullable&lt;T&gt;</code> -- 从T中剔除null和undefined。</li> <li><code>ReturnType&lt;T&gt;</code> -- 获取函数返回值类型。</li> <li><code>InstanceType&lt;T&gt;</code> -- 获取构造函数类型的实例类型。</li></ul></div> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// Exclude</span>
<span class="token keyword">type</span> Type <span class="token operator">=</span> Exclude<span class="token operator">&lt;</span><span class="token string">'a'</span> <span class="token operator">|</span> <span class="token string">'b'</span> <span class="token operator">|</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token operator">&gt;</span>  <span class="token comment">// type Type = &quot;a&quot; | &quot;b&quot;</span>
<span class="token comment">// Extract</span>
<span class="token keyword">type</span> Type <span class="token operator">=</span> Extract<span class="token operator">&lt;</span><span class="token string">'a'</span> <span class="token operator">|</span> <span class="token string">'b'</span> <span class="token operator">|</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'c'</span> <span class="token operator">|</span> <span class="token string">'b'</span><span class="token operator">&gt;</span>  <span class="token comment">// type Type = &quot;b&quot; | &quot;c&quot;</span>
<span class="token comment">// NonNullable</span>
<span class="token keyword">type</span> Type <span class="token operator">=</span> NonNullable<span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">|</span> undefined<span class="token operator">&gt;</span>  <span class="token comment">// type Type = string | number</span>
<span class="token comment">// ReturnType</span>
<span class="token keyword">type</span> Type <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span><span class="token operator">&gt;</span>  <span class="token comment">// type Type = string</span>
<span class="token comment">// InstanceType</span>
<span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> name<span class="token punctuation">:</span> <span class="token builtin">string</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Type <span class="token operator">=</span> InstanceType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> <span class="token constant">C</span><span class="token operator">&gt;</span> <span class="token comment">// type Type = C</span>
<span class="token keyword">type</span> Type <span class="token operator">=</span> InstanceType<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span>      <span class="token comment">// any</span>
<span class="token keyword">type</span> Type <span class="token operator">=</span> InstanceType<span class="token operator">&lt;</span><span class="token builtin">never</span><span class="token operator">&gt;</span>    <span class="token comment">// any</span>
<span class="token keyword">type</span> Type <span class="token operator">=</span> InstanceType<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span>   <span class="token comment">// error</span>
</code></pre></div><h2 id="更新"><a href="#更新" aria-hidden="true" class="header-anchor">#</a> 更新</h2> <p>keyof 和 映射类型在2.9版本的升级，支持用number和symbol命名属性。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> stringIndex <span class="token operator">=</span> <span class="token string">'a'</span>
<span class="token keyword">const</span> numberIndex <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">const</span> symbolIndex <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">type</span> Obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>stringIndex<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>numberIndex<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>symbolIndex<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">symbol</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> keysType <span class="token operator">=</span> <span class="token keyword">keyof</span> Obj <span class="token comment">// type keysType = 'a' | 1 | typeof symbolIndex</span>

<span class="token keyword">type</span> ReadonlyTypes<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> objs<span class="token punctuation">:</span> ReadonlyTypes<span class="token operator">&lt;</span>Obj<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token string">'aa'</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>symbolIndex<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在3.1版本中，元组和数组上的映射对象类型现在会生成新的元组/数组，而非创建一个新的类型并且这个类型上具有如push()，pop()和length这样的成员。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> MapToPromise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> Tuple <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">boolean</span><span class="token punctuation">]</span>
<span class="token keyword">type</span> promiseTuple <span class="token operator">=</span> MapToPromise<span class="token operator">&lt;</span>Tuple<span class="token operator">&gt;</span>
<span class="token comment">// [ Promise&lt;number&gt;, Promise&lt;string&gt;, Promise&lt;boolean&gt; ]</span>

<span class="token keyword">let</span> tuple<span class="token punctuation">:</span> promiseTuple <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="unknown类型"><a href="#unknown类型" aria-hidden="true" class="header-anchor">#</a> unknown类型</h2> <ol><li>任何类型都可以赋值给unknown类型</li></ol> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> value1<span class="token punctuation">:</span> <span class="token builtin">unknown</span>
value1 <span class="token operator">=</span> <span class="token string">'a'</span>
value1 <span class="token operator">=</span> <span class="token number">123</span>
</code></pre></div><ol start="2"><li>如果没有类型断言或基于控制流的类型细化时，unknown不可以赋值给其它类型，只能赋值给它自身和any类型</li></ol> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> value2<span class="token punctuation">:</span> <span class="token builtin">unknown</span>
<span class="token keyword">let</span> value3<span class="token punctuation">:</span> <span class="token builtin">string</span>
value3 <span class="token operator">=</span> value2 <span class="token comment">// error</span>
</code></pre></div><ol start="3"><li>如果没有类型断言或基于控制流的类型细化时，unknown不能进行任何操作</li></ol> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> value4<span class="token punctuation">:</span> <span class="token builtin">unknown</span>
value4 <span class="token operator">+=</span> <span class="token number">1</span> <span class="token comment">// error</span>
</code></pre></div><ol start="4"><li>unknown与任何其它类型组成的交叉类型，都等于其它类型</li></ol> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">&amp;</span> <span class="token builtin">unknown</span>   <span class="token comment">// string</span>
<span class="token keyword">type</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token builtin">number</span> <span class="token operator">&amp;</span> <span class="token builtin">unknown</span>   <span class="token comment">// number</span>
<span class="token keyword">type</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token builtin">unknown</span> <span class="token comment">// string[]</span>
<span class="token keyword">type</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token builtin">unknown</span> <span class="token operator">&amp;</span> <span class="token builtin">unknown</span>  <span class="token comment">// unknown</span>
</code></pre></div><ol start="5"><li>unknown与任何其它类型组成的联合类型，都等于unknown类型(除any外)</li></ol> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">unknown</span>   <span class="token comment">// unknown</span>
<span class="token keyword">type</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token builtin">unknown</span> <span class="token comment">// unknown</span>
<span class="token keyword">type</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">unknown</span>   <span class="token comment">// unknown</span>
<span class="token keyword">type</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token builtin">any</span> <span class="token operator">|</span> <span class="token builtin">unknown</span>      <span class="token comment">// any</span>
</code></pre></div><ol start="6"><li>never类型是unknown类型的子类型</li></ol> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token builtin">never</span> <span class="token keyword">extends</span> <span class="token class-name">unknown</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token comment">// true</span>
</code></pre></div><ol start="7"><li>keyof unknown 等于 never类型</li></ol> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token keyword">keyof</span> <span class="token builtin">unknown</span> <span class="token comment">// never</span>
</code></pre></div><ol start="8"><li>只能对unknown进行等或不等操作</li></ol> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">:</span> <span class="token builtin">unknown</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">;</span>
    x <span class="token operator">!==</span> <span class="token number">10</span><span class="token punctuation">;</span>
    x <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// Error</span>
    x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
    x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
    <span class="token operator">-</span>x<span class="token punctuation">;</span>      <span class="token comment">// Error</span>
    <span class="token operator">+</span>x<span class="token punctuation">;</span>      <span class="token comment">// Error</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="9"><li>unknown类型的值不能访问其属性、不能作为函数调用、不能作为类创建实例</li></ol> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">:</span> <span class="token builtin">unknown</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>    <span class="token comment">// Error</span>
    x<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// Error</span>
    <span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// Error</span>
    <span class="token keyword">new</span> <span class="token class-name">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Error</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="10"><li>使用映射类型时，如果遍历的是unknown类型时，则不会映射任何属性</li></ol> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> Type<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span> <span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token keyword">type</span> <span class="token operator">=</span> Type<span class="token operator">&lt;</span><span class="token builtin">unknown</span><span class="token operator">&gt;</span> <span class="token comment">// {}</span>
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">最近一次更新时间: </span> <span class="time">5/8/2019, 5:40:48 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/notes/notes/inference-compatibility.html" class="prev">
          类型兼容性
        </a></span> <span class="next"><a href="/notes/notes/es6-module.html">
          ES6和NodeJs中的模块
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/notes/assets/js/app.7bd01eb6.js" defer></script><script src="/notes/assets/js/6.fba5fac9.js" defer></script>
  </body>
</html>
